<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel</title>
  <link rel="stylesheet" href="/stylesheets/style2.css" />
</head>

<body>

  <div class="admin-wrapper">

    <!-- Sidebar overlay (mobile) -->
    <div class="sidebar-overlay" id="sidebarOverlay"
      onclick="document.getElementById('sidebar').classList.remove('open');this.classList.remove('show');"></div>

    <!-- ===== SIDEBAR ===== -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-brand">
        <div class="brand-icon">‚¨°</div>
        Admin Panel
      </div>
      <nav class="sidebar-nav">
        <div class="nav-label">Main</div>

        <a class="nav-item active" href="#dashboard" onclick="navigate('dashboard')">
          <span class="nav-icon">üìä</span> Dashboard
        </a>
        <div class="nav-label">Management</div>
        <% if(["user_view", "user_update" ,"user_add","user_delete"].some(r=> userPermissionsName.includes(r))){ %>
          <a class="nav-item" href="#users" onclick="navigate('users')">
            <span class="nav-icon">üë•</span> Users
          </a>
          <% } %>
            <% if(["role_view", "role_update" ,"role_add","role_delete"].some(r=> userPermissionsName.includes(r))){ %>
              <a class="nav-item" href="#roles" onclick="navigate('roles')">
                <span class="nav-icon">üõ°Ô∏è</span> Roles
              </a>
              <% } %>
                <% if(["category_view", "category_update" ,"category_add","category_delete","category_export"].some(r=>
                  userPermissionsName.includes(r))){ %>
                  <a class="nav-item" href="#categories" onclick="navigate('categories')">
                    <span class="nav-icon">üìÇ</span> Categories
                  </a>
                  <% } %>
                    <% if(["role_view", "role_update" ,"role_add","role_delete"].some(r=>
                      userPermissionsName.includes(r))){ %>
                      <a class="nav-item" href="#rolePrivileges" onclick="navigate('rolePrivileges')">
                        <span class="nav-icon">üîë</span> Role Privileges
                      </a>
                      <% } %>
                        <% if(["auditlogs_view"].some(r=> userPermissionsName.includes(r))){ %>
                          <div class="nav-label">System</div>
                          <a class="nav-item" href="#auditLogs" onclick="navigate('auditLogs')">
                            <span class="nav-icon">üìã</span> Audit Logs
                          </a>
                          <% } %>
                            <div class="nav-label">Account</div>
                            <a class="nav-item" href="#myPermissions" onclick="navigate('myPermissions')">
                              <span class="nav-icon">üîê</span> My Permissions
                            </a>
      </nav>
      <div class="sidebar-footer">
        <a class="logout-btn" href="/api/admin/logout">
          <span>üö™</span> Logout
        </a>
      </div>
    </aside>

    <!-- ===== MAIN ===== -->
    <div class="main-wrapper">
      <!-- Navbar -->
      <header class="navbar">
        <div class="navbar-left">
          <button class="hamburger"
            onclick="document.getElementById('sidebar').classList.toggle('open');document.getElementById('sidebarOverlay').classList.toggle('show');">‚ò∞</button>
          <span class="navbar-title" id="navTitle">Dashboard</span>
        </div>
        <div class="navbar-right">
          <div class="navbar-avatar" title="Admin">A</div>
        </div>
      </header>

      <!-- ============================================================= -->
      <!--  SECTION: Dashboard                                           -->
      <!-- ============================================================= -->
      <main class="content section" id="section-dashboard">

        <div class="dash-grid">
          <div class="dash-card">
            <div class="card-icon purple">üë•</div>
            <div class="card-value">
              <%= countDB[0].usersLength %>
            </div>
            <div class="card-label">Total Users ¬∑ <%= countDB[1].activeUsersLength %> active</div>
          </div>


          <div class="dash-card">
            <div class="card-icon green">üõ°Ô∏è</div>
            <div class="card-value">
              <%= countDB[0].rolesLength %>
            </div>
            <div class="card-label">Roles ¬∑ <%= countDB[1].activeRolesLength %> active</div>
          </div>
          <div class="dash-card">
            <div class="card-icon amber">üìÇ</div>
            <div class="card-value">
              <%= countDB[0].categoriesLength %>
            </div>
            <div class="card-label">Categories ¬∑ <%= countDB[1].activeCategoriesLength %> active</div>
          </div>
          <div class="dash-card">
            <div class="card-icon sky">üìã</div>
            <div class="card-value">
              <%= countDB[0].auditlogsLength %>
            </div>
            <div class="card-label">Audit Logs</div>
          </div>

        </div>

        <% if(["auditlogs_view"].some(r=> userPermissionsName.includes(r))){ %>
          <div class="section-header"><span class="section-title">Recent Audit Logs</span></div>

          <!-- CSS-only pagination radio inputs -->
          <input type="radio" name="dash-audit-page" id="dash-audit-page-1" class="pagination-radio" checked>
          <input type="radio" name="dash-audit-page" id="dash-audit-page-2" class="pagination-radio">
          <input type="radio" name="dash-audit-page" id="dash-audit-page-3" class="pagination-radio">
          <input type="radio" name="dash-audit-page" id="dash-audit-page-4" class="pagination-radio">
          <input type="radio" name="dash-audit-page" id="dash-audit-page-5" class="pagination-radio">

          <div class="table-wrapper dash-audit-paginated">
            <table>
              <thead>
                <tr>
                  <th>Level</th>
                  <th>Email</th>
                  <th>Location</th>
                  <th>Type</th>
                  <th>Log</th>
                </tr>
              </thead>
              <tbody>
                <% if(auditlogs && auditlogs.length> 0){ %>
                  <% for(let auditlog of auditlogs){ %>
                    <tr>
                      <td><span class="log-level log-info">
                          <%= auditlog.level%>
                        </span></td>
                      <td>
                        <%= auditlog.email %>
                      </td>
                      <td>
                        <%= auditlog.location %>
                      </td>
                      <td>
                        <%= auditlog.proc_type %>
                      </td>
                      <td style="max-width: 250px; word-wrap: break-word; white-space: normal;">
                        <%= JSON.stringify(auditlog.log) %>
                      </td>
                    </tr>
                    <% } %>
                      <% } %>
              </tbody>
            </table>
          </div>

          <!-- Pagination buttons -->
          <div class="pagination dash-audit-pagination">
            <span class="pagination-info">Pages</span>
            <div class="pagination-btns">
              <% for(let i=0;i < (auditlogs.length /50);i++){ %>
                <label for="dash-audit-page-<%=i+1%>" class="page-btn">
                  <%=i+1%>
                </label>
                <% } %>
            </div>
          </div>
          <% } %>
      </main>

      <!-- ============================================================= -->
      <!--  SECTION: Users                                               -->
      <!-- ============================================================= -->
      <main class="content section" id="section-users" style="display:none;">

        <div class="section-header">
          <span class="section-title">Users</span>
          <div class="toolbar">
            <input class="search-box" type="text" placeholder="Search users‚Ä¶" />
            <% if(["user_add"].some(r=>userPermissionsName.includes(r))){ %>
              <button class="btn btn-primary" onclick="openModal('addUserModal')">Ôºã Add User</button>
              <% } %>
          </div>
        </div>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Email</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Phone</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% if(users && users.length> 0){ %>
                <% for(let user of users){ %>
                  <tr>
                    <td>
                      <%= user.email %>
                    </td>
                    <td>
                      <%= user.first_name %>
                    </td>
                    <td>
                      <%= user.last_name %>
                    </td>
                    <td>
                      <%= user.phone_number %>
                    </td>
                    <td><span class="badge <%= user.is_active ? " badge-active" : "badge-inactive" %>"><%=user.is_active
                          ? "Active" : "Inactive" %> </span></td>
                    <td class="actions-cell">
                      <% if(["user_update"].some(r=>userPermissionsName.includes(r))){ %>
                        <button class="btn btn-sm btn-edit" onclick="openModal('editUserModal'); getValueOfEditUserInput('<%= JSON.stringify(user) %>');">‚úèÔ∏è Edit</button>
                      <% } %>
                      <% if(["user_delete"].some(r=>userPermissionsName.includes(r))){ %>
                        <button class="btn btn-sm btn-delete" onclick="deleteUser('<%= user._id %>')">üóëÔ∏è Del</button>
                      <% } %>
                      <% if (!["user_update"].some(r=>userPermissionsName.includes(r)) && !["user_delete"].some(r=>userPermissionsName.includes(r))){%>
                                <button class="btn btn-sm ">üö´</button>
                      <% } %>
                    </td>
                  </tr>
                  <%}%>
                    <%}%>
            </tbody>
          </table>
          <div class="pagination">
            <span class="pagination-info">Showing 1‚Äì12 of 12</span>
            <div class="pagination-btns"><button class="page-btn active">1</button></div>
          </div>
        </div>
      </main>

      <!-- ============================================================= -->
      <!--  SECTION: Roles                                               -->
      <!-- ============================================================= -->
      <main class="content section" id="section-roles" style="display:none;">

        <div class="section-header">
          <span class="section-title">Roles</span>
          <div class="toolbar">
            <input class="search-box" type="text" placeholder="Search roles‚Ä¶" />
            <button class="btn btn-primary" onclick="openModal('addRoleModal')">Ôºã Add Role</button>
          </div>
        </div>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Role Name</th>
                <th>Status</th>
                <th>Created By</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Super Admin</td>
                <td><span class="badge badge-active">Active</span></td>
                <td>admin@demo.com</td>
                <td class="actions-cell"><button class="btn btn-sm btn-edit" onclick="openModal('editRoleModal')">‚úèÔ∏è
                    Edit</button><button class="btn btn-sm btn-delete">üóëÔ∏è Del</button></td>
              </tr>
              <tr>
                <td>Editor</td>
                <td><span class="badge badge-active">Active</span></td>
                <td>admin@demo.com</td>
                <td class="actions-cell"><button class="btn btn-sm btn-edit">‚úèÔ∏è Edit</button><button
                    class="btn btn-sm btn-delete">üóëÔ∏è Del</button></td>
              </tr>
              <tr>
                <td>Viewer</td>
                <td><span class="badge badge-active">Active</span></td>
                <td>admin@demo.com</td>
                <td class="actions-cell"><button class="btn btn-sm btn-edit">‚úèÔ∏è Edit</button><button
                    class="btn btn-sm btn-delete">üóëÔ∏è Del</button></td>
              </tr>
              <tr>
                <td>Manager</td>
                <td><span class="badge badge-active">Active</span></td>
                <td>admin@demo.com</td>
                <td class="actions-cell"><button class="btn btn-sm btn-edit">‚úèÔ∏è Edit</button><button
                    class="btn btn-sm btn-delete">üóëÔ∏è Del</button></td>
              </tr>
              <tr>
                <td>Support Agent</td>
                <td><span class="badge badge-inactive">Inactive</span></td>
                <td>admin@demo.com</td>
                <td class="actions-cell"><button class="btn btn-sm btn-edit">‚úèÔ∏è Edit</button><button
                    class="btn btn-sm btn-delete">üóëÔ∏è Del</button></td>
              </tr>
              <tr>
                <td>Developer</td>
                <td><span class="badge badge-active">Active</span></td>
                <td>manager@demo.com</td>
                <td class="actions-cell"><button class="btn btn-sm btn-edit">‚úèÔ∏è Edit</button><button
                    class="btn btn-sm btn-delete">üóëÔ∏è Del</button></td>
              </tr>
              <tr>
                <td>QA Tester</td>
                <td><span class="badge badge-active">Active</span></td>
                <td>manager@demo.com</td>
                <td class="actions-cell"><button class="btn btn-sm btn-edit">‚úèÔ∏è Edit</button><button
                    class="btn btn-sm btn-delete">üóëÔ∏è Del</button></td>
              </tr>
              <tr>
                <td>HR Staff</td>
                <td><span class="badge badge-inactive">Inactive</span></td>
                <td>admin@demo.com</td>
                <td class="actions-cell"><button class="btn btn-sm btn-edit">‚úèÔ∏è Edit</button><button
                    class="btn btn-sm btn-delete">üóëÔ∏è Del</button></td>
              </tr>
            </tbody>
          </table>
          <div class="pagination">
            <span class="pagination-info">Showing 1‚Äì8 of 8</span>
            <div class="pagination-btns"><button class="page-btn active">1</button></div>
          </div>
        </div>
      </main>

      <!-- ============================================================= -->
      <!--  SECTION: Categories                                          -->
      <!-- ============================================================= -->
      <main class="content section" id="section-categories" style="display:none;">

        <div class="section-header">
          <span class="section-title">Categories</span>
          <div class="toolbar">
            <input class="search-box" type="text" placeholder="Search categories‚Ä¶" />
             <% if(["category_add"].some(r=>userPermissionsName.includes(r))){ %>
            <button class="btn btn-primary" onclick="openModal('addCategoryModal')">Ôºã Add Category</button>
            <%}%>
          </div>
        </div>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Status</th>
                <th>Created By</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% if(categories && categories.length > 0){%>
                <% for(let category of categories) {%>
              <tr>
                <td><%=category.name%></td>
                <td><span class="badge <%= category.is_active ? " badge-active" : "badge-inactive" %>"><%=category.is_active ? "Active" : "Inactive" %> </span></td>
                <td><%=category.created_by.email%></td>
                <td class="actions-cell">
                  <% if(["category_update"].some(r=>userPermissionsName.includes(r))){ %>
                        <button class="btn btn-sm btn-edit" onclick="openModal('editCategoryModal'); getValueOfEditInput('<%= JSON.stringify(category) %>');">‚úèÔ∏è Edit</button>
                      <% } %>
                      <% if(["category_delete"].some(r=>userPermissionsName.includes(r))){ %>
                        <button class="btn btn-sm btn-delete" onclick="deleteCategory('<%= category._id %>')">üóëÔ∏è Del</button>
                      <% } %>
                      <% if (!["category_update"].some(r=>userPermissionsName.includes(r)) && !["category_delete"].some(r=>userPermissionsName.includes(r))){%>
                                <button class="btn btn-sm ">üö´</button>
                    <% } %>
                </td>
              </tr>
                <%}%>
              <%}%>
            </tbody>
          </table>
          <div class="pagination">
            <span class="pagination-info">Showing 1‚Äì10 of 10</span>
            <div class="pagination-btns"><button class="page-btn active">1</button></div>
          </div>
        </div>
      </main>

      <!-- ============================================================= -->
      <!--  SECTION: Role Privileges                                     -->
      <!-- ============================================================= -->
      <main class="content section" id="section-rolePrivileges" style="display:none;">

        <div class="section-header">
          <span class="section-title">Role Privileges</span>
          <div class="toolbar">
            <input class="search-box" type="text" placeholder="Search privileges‚Ä¶" />
            <button class="btn btn-primary" onclick="openModal('addRolePrivilegeModal')">Ôºã Add Role Privilege</button>
          </div>
        </div>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Role</th>
                <th>Permissions</th>
                <th>Created By</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Super Admin</td>
                <td>users:read,write,delete | roles:read,write,delete | categories:read,write,delete | logs:read</td>
                <td>admin@demo.com</td>
                <td class="actions-cell"><button class="btn btn-sm btn-edit"
                    onclick="openModal('editRolePrivilegeModal')">‚úèÔ∏è Edit</button><button
                    class="btn btn-sm btn-delete">üóëÔ∏è Del</button></td>
              </tr>
              <tr>
                <td>Editor</td>
                <td>users:read | categories:read,write | logs:read</td>
                <td>admin@demo.com</td>
                <td class="actions-cell"><button class="btn btn-sm btn-edit"
                    onclick="openModal('editRolePrivilegeModal')">‚úèÔ∏è Edit</button><button
                    class="btn btn-sm btn-delete">üóëÔ∏è Del</button></td>
              </tr>
              <tr>
                <td>Viewer</td>
                <td>users:read | categories:read | logs:read</td>
                <td>admin@demo.com</td>
                <td class="actions-cell"><button class="btn btn-sm btn-edit"
                    onclick="openModal('editRolePrivilegeModal')">‚úèÔ∏è Edit</button><button
                    class="btn btn-sm btn-delete">üóëÔ∏è Del</button></td>
              </tr>
              <tr>
                <td>Manager</td>
                <td>users:read,write | roles:read | categories:read,write | logs:read</td>
                <td>admin@demo.com</td>
                <td class="actions-cell"><button class="btn btn-sm btn-edit"
                    onclick="openModal('editRolePrivilegeModal')">‚úèÔ∏è Edit</button><button
                    class="btn btn-sm btn-delete">üóëÔ∏è Del</button></td>
              </tr>
              <tr>
                <td>Support Agent</td>
                <td>users:read | categories:read</td>
                <td>admin@demo.com</td>
                <td class="actions-cell"><button class="btn btn-sm btn-edit"
                    onclick="openModal('editRolePrivilegeModal')">‚úèÔ∏è Edit</button><button
                    class="btn btn-sm btn-delete">üóëÔ∏è Del</button></td>
              </tr>
              <tr>
                <td>Developer</td>
                <td>users:read | categories:read,write,delete | logs:read</td>
                <td>manager@demo.com</td>
                <td class="actions-cell"><button class="btn btn-sm btn-edit"
                    onclick="openModal('editRolePrivilegeModal')">‚úèÔ∏è Edit</button><button
                    class="btn btn-sm btn-delete">üóëÔ∏è Del</button></td>
              </tr>
              <tr>
                <td>QA Tester</td>
                <td>users:read | categories:read | logs:read</td>
                <td>manager@demo.com</td>
                <td class="actions-cell"><button class="btn btn-sm btn-edit"
                    onclick="openModal('editRolePrivilegeModal')">‚úèÔ∏è Edit</button><button
                    class="btn btn-sm btn-delete">üóëÔ∏è Del</button></td>
              </tr>
              <tr>
                <td>HR Staff</td>
                <td>users:read</td>
                <td>admin@demo.com</td>
                <td class="actions-cell"><button class="btn btn-sm btn-edit"
                    onclick="openModal('editRolePrivilegeModal')">‚úèÔ∏è Edit</button><button
                    class="btn btn-sm btn-delete">üóëÔ∏è Del</button></td>
              </tr>
            </tbody>
          </table>
          <div class="pagination">
            <span class="pagination-info">Showing 1‚Äì8 of 8</span>
            <div class="pagination-btns"><button class="page-btn active">1</button></div>
          </div>
        </div>
      </main>

      <!-- ============================================================= -->
      <!--  SECTION: Audit Logs                                          -->
      <!-- ============================================================= -->
      <main class="content section" id="section-auditLogs" style="display:none;">

        <div class="section-header">
          <span class="section-title">Audit Logs</span>
          <div class="toolbar">
            <input class="search-box" type="text" placeholder="Search logs‚Ä¶" />
          </div>
        </div>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Level</th>
                <th>Email</th>
                <th>Location</th>
                <th>Type</th>
                <th>Log</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><span class="log-level log-info">info</span></td>
                <td>admin@demo.com</td>
                <td>/api/users</td>
                <td>GET</td>
                <td>Fetched user list</td>
              </tr>
              <tr>
                <td><span class="log-level log-info">info</span></td>
                <td>admin@demo.com</td>
                <td>/api/users/1</td>
                <td>PUT</td>
                <td>Updated user profile</td>
              </tr>
              <tr>
                <td><span class="log-level log-warn">warn</span></td>
                <td>editor@demo.com</td>
                <td>/api/categories</td>
                <td>POST</td>
                <td>Attempted duplicate category creation</td>
              </tr>
              <tr>
                <td><span class="log-level log-error">error</span></td>
                <td>viewer@demo.com</td>
                <td>/api/roles</td>
                <td>DELETE</td>
                <td>Unauthorized delete attempt</td>
              </tr>
              <tr>
                <td><span class="log-level log-info">info</span></td>
                <td>manager@demo.com</td>
                <td>/api/login</td>
                <td>POST</td>
                <td>Successful login</td>
              </tr>
              <tr>
                <td><span class="log-level log-debug">debug</span></td>
                <td>dev@demo.com</td>
                <td>/api/roles/6</td>
                <td>GET</td>
                <td>Debug: role cache miss</td>
              </tr>
              <tr>
                <td><span class="log-level log-warn">warn</span></td>
                <td>support@demo.com</td>
                <td>/api/users/5</td>
                <td>PUT</td>
                <td>Rate limit approaching</td>
              </tr>
              <tr>
                <td><span class="log-level log-info">info</span></td>
                <td>admin@demo.com</td>
                <td>/api/categories/1</td>
                <td>PUT</td>
                <td>Category updated</td>
              </tr>
              <tr>
                <td><span class="log-level log-error">error</span></td>
                <td>test@demo.com</td>
                <td>/api/privileges</td>
                <td>POST</td>
                <td>Validation failed: missing role_id</td>
              </tr>
              <tr>
                <td><span class="log-level log-info">info</span></td>
                <td>admin@demo.com</td>
                <td>/api/logout</td>
                <td>POST</td>
                <td>User logged out</td>
              </tr>
              <tr>
                <td><span class="log-level log-debug">debug</span></td>
                <td>dev@demo.com</td>
                <td>/api/health</td>
                <td>GET</td>
                <td>Health check OK</td>
              </tr>
              <tr>
                <td><span class="log-level log-warn">warn</span></td>
                <td>hr@demo.com</td>
                <td>/api/users</td>
                <td>POST</td>
                <td>Weak password detected</td>
              </tr>
              <tr>
                <td><span class="log-level log-info">info</span></td>
                <td>finance@demo.com</td>
                <td>/api/reports</td>
                <td>GET</td>
                <td>Report generated</td>
              </tr>
              <tr>
                <td><span class="log-level log-error">error</span></td>
                <td>ops@demo.com</td>
                <td>/api/deploy</td>
                <td>POST</td>
                <td>Deployment failed: timeout</td>
              </tr>
              <tr>
                <td><span class="log-level log-info">info</span></td>
                <td>legal@demo.com</td>
                <td>/api/login</td>
                <td>POST</td>
                <td>Login attempt ‚Äì account inactive</td>
              </tr>
            </tbody>
          </table>
          <div class="pagination">
            <span class="pagination-info">Showing 1‚Äì15 of 15</span>
            <div class="pagination-btns"><button class="page-btn active">1</button></div>
          </div>
        </div>
      </main>

      <!-- ============================================================= -->
      <!--  SECTION: My Permissions                                      -->
      <!-- ============================================================= -->
      <main class="content section" id="section-myPermissions" style="display:none;">
        <div class="section-header">
          <span class="section-title">My Permissions</span>
        </div>
        <div class="permissions-container">
          <p class="permissions-description">These are the permissions assigned to your current account:</p>
          <div class="permissions-grid">
            <% for(let permission of userPermissionsName){%>
              <span class="permission-badge">
                <%= permission %>
              </span>

              <% } %>
          </div>
        </div>
      </main>

    </div>
  </div>

  <!-- ===== MODALS ===== -->

  <!-- Add User Modal -->
  <div class="modal-overlay" id="addUserModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Add New User</h3>
        <button class="modal-close" onclick="closeModal('addUserModal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="addUserForm">
          <div class="form-group">
            <label>Email *</label>
            <input class="form-control" type="email" name="email" placeholder="user@example.com" />
          </div>
          <div class="form-group">
            <label>Password *</label>
            <input class="form-control" type="password" name="password" placeholder="Min 8 characters" />
          </div>
          <div class="form-group">
            <label>First Name</label>
            <input class="form-control" type="text" name="first_name" placeholder="First name" />
          </div>
          <div class="form-group">
            <label>Last Name</label>
            <input class="form-control" type="text" name="last_name" placeholder="Last name" />
          </div>
          <div class="form-group">
            <label>Phone Number</label>
            <input class="form-control" type="text" name="phone_number" placeholder="+90 5xx xxx xxxx" />
          </div>
          <div class="form-group">
            <label>Role</label>
            <select class="form-control" name="roles">
              <option value="">Select a role...</option>
              <%if(allroles){ %>
                <% for(let role of allroles) { %>
                  <option value="<%= role._id %>">
                    <%= role.role_name %>
                  </option>
                  <%}%>
                    <%}%>
            </select>
          </div>
          <div class="modal-footer">
            <button class="btn btn-outline" onclick="closeModal('addUserModal')">Cancel</button>
            <button type="submit" class="btn btn-primary">Add User</button>
          </div>
        </form>
      </div>

    </div>
  </div>

  <!-- Add Role Modal -->
  <div class="modal-overlay" id="addRoleModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Add New Role</h3>
        <button class="modal-close" onclick="closeModal('addRoleModal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="addRoleForm">
          <div class="form-group">
            <label>Role Name *</label>
            <input class="form-control" type="text" name="role_name" placeholder="e.g. Editor" />
          </div>
          <div class="form-group">
            <label>Permissions</label>
            <div style="display:flex;flex-wrap:wrap;gap:8px;margin-top:6px;">
              <label class="checkbox-label"><input type="checkbox" name="permissions" value="user_view"> User
                View</label>
              <label class="checkbox-label"><input type="checkbox" name="permissions" value="user_add"> User Add</label>
              <label class="checkbox-label"><input type="checkbox" name="permissions" value="user_update"> User
                Update</label>
              <label class="checkbox-label"><input type="checkbox" name="permissions" value="user_delete"> User
                Delete</label>
              <label class="checkbox-label"><input type="checkbox" name="permissions" value="role_view"> Role
                View</label>
              <label class="checkbox-label"><input type="checkbox" name="permissions" value="role_add"> Role Add</label>
              <label class="checkbox-label"><input type="checkbox" name="permissions" value="role_update"> Role
                Update</label>
              <label class="checkbox-label"><input type="checkbox" name="permissions" value="role_delete"> Role
                Delete</label>
              <label class="checkbox-label"><input type="checkbox" name="permissions" value="category_view"> Category
                View</label>
              <label class="checkbox-label"><input type="checkbox" name="permissions" value="category_add"> Category
                Add</label>
              <label class="checkbox-label"><input type="checkbox" name="permissions" value="category_update"> Category
                Update</label>
              <label class="checkbox-label"><input type="checkbox" name="permissions" value="category_delete"> Category
                Delete</label>
              <label class="checkbox-label"><input type="checkbox" name="permissions" value="category_export"> Category
                Export</label>
              <label class="checkbox-label"><input type="checkbox" name="permissions" value="auditlogs_view"> Auditlogs
                View</label>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="closeModal('addRoleModal')">Cancel</button>
        <button class="btn btn-primary">Add Role</button>
      </div>
    </div>
  </div>

  <!-- Add Category Modal -->
  <div class="modal-overlay" id="addCategoryModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Add New Category</h3>
        <button class="modal-close" onclick="closeModal('addCategoryModal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="addCategoryForm">
          <div class="form-group">
            <label>Category Name *</label>
            <input class="form-control" type="text" name="name" placeholder="e.g. Electronics" />
          </div>
          <div class="modal-footer">
            <button class="btn btn-outline" onclick="closeModal('addCategoryModal')">Cancel</button>
            <button class="btn btn-primary">Add Category</button>
          </div>
        </form>
      </div>
      
    </div>
  </div>

  <!-- Add Role Privilege Modal -->
  <div class="modal-overlay" id="addRolePrivilegeModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Add Role Privilege</h3>
        <button class="modal-close" onclick="closeModal('addRolePrivilegeModal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="addRolePrivilegeForm">
          <div class="form-group">
            <label>Role *</label>
            <select class="form-control" name="role_id">
              <option value="">Select a role...</option>
              <option value="admin">Admin</option>
              <option value="user">User</option>
              <option value="editor">Editor</option>
            </select>
          </div>
          <div class="form-group">
            <label>Permission *</label>
            <select class="form-control" name="permission">
              <option value="">Select a permission...</option>
              <option value="user_view">User View</option>
              <option value="user_add">User Add</option>
              <option value="user_update">User Update</option>
              <option value="user_delete">User Delete</option>
              <option value="role_view">Role View</option>
              <option value="role_add">Role Add</option>
              <option value="role_update">Role Update</option>
              <option value="role_delete">Role Delete</option>
              <option value="category_view">Category View</option>
              <option value="category_add">Category Add</option>
              <option value="category_update">Category Update</option>
              <option value="category_delete">Category Delete</option>
              <option value="category_export">Category Export</option>
              <option value="auditlogs_view">Auditlogs View</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="closeModal('addRolePrivilegeModal')">Cancel</button>
        <button class="btn btn-primary">Add Privilege</button>
      </div>
    </div>
  </div>

  <!-- Edit User Modal -->
  <div class="modal-overlay" id="editUserModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Edit User</h3>
        <button class="modal-close" onclick="closeModal('editUserModal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="editUserForm">
          <div class="form-group">
            <label>Email *</label>
            <input class="form-control" type="email" name="email" placeholder="user@example.com" disabled/>
          </div>
          <div class="form-group">
            <label>Password</label>
            <input class="form-control" type="password" name="password" placeholder="Leave blank to keep current" />
          </div>
          <div class="form-group">
            <label>First Name</label>
            <input class="form-control" type="text" name="first_name" placeholder="First name" />
          </div>
          <div class="form-group">
            <label>Last Name</label>
            <input class="form-control" type="text" name="last_name" placeholder="Last name" />
          </div>
          <div class="form-group">
            <label>Phone Number</label>
            <input class="form-control" type="text" name="phone_number" placeholder="+90 5xx xxx xxxx" />
          </div>
          <div class="form-group">
            <label>Role</label>
            <select id="edit_user_role" class="form-control" name="roles">
              <option value="">Select a role...</option>
              <%if(allroles){ %>
                <% for(let role of allroles) { %>
                  <option value="<%= role._id %>">
                    <%= role.role_name %>
                  </option>
                  <%}%>
                    <%}%>
            </select>
          </div>
          <div class="form-group">
            <label>Status</label>
            <select id="edit_is_active" class="form-control" name="is_active">
              <option value="true">Active</option>
              <option value="false">Inactive</option>
            </select>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-outline" onclick="closeModal('editUserModal')">Cancel</button>
            <button type="submit" class="btn btn-primary">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Edit Role Modal -->
  <div class="modal-overlay" id="editRoleModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Edit Role</h3>
        <button class="modal-close" onclick="closeModal('editRoleModal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="editRoleForm">
          <div class="form-group">
            <label>Role Name *</label>
            <input class="form-control" type="text" name="role_name" placeholder="e.g. Editor" />
          </div>
          <div class="form-group">
            <label>Status</label>
            <select class="form-control" name="is_active">
              <option value="true">Active</option>
              <option value="false">Inactive</option>
            </select>
          </div>
          <div class="form-group">
            <label>Permissions</label>
            <div style="display:flex;flex-wrap:wrap;gap:8px;margin-top:6px;">
              <label class="checkbox-label"><input type="checkbox" name="permissions" value="user_view"> User
                View</label>
              <label class="checkbox-label"><input type="checkbox" name="permissions" value="user_add"> User Add</label>
              <label class="checkbox-label"><input type="checkbox" name="permissions" value="user_update"> User
                Update</label>
              <label class="checkbox-label"><input type="checkbox" name="permissions" value="user_delete"> User
                Delete</label>
              <label class="checkbox-label"><input type="checkbox" name="permissions" value="role_view"> Role
                View</label>
              <label class="checkbox-label"><input type="checkbox" name="permissions" value="role_add"> Role Add</label>
              <label class="checkbox-label"><input type="checkbox" name="permissions" value="role_update"> Role
                Update</label>
              <label class="checkbox-label"><input type="checkbox" name="permissions" value="role_delete"> Role
                Delete</label>
              <label class="checkbox-label"><input type="checkbox" name="permissions" value="category_view"> Category
                View</label>
              <label class="checkbox-label"><input type="checkbox" name="permissions" value="category_add"> Category
                Add</label>
              <label class="checkbox-label"><input type="checkbox" name="permissions" value="category_update"> Category
                Update</label>
              <label class="checkbox-label"><input type="checkbox" name="permissions" value="category_delete"> Category
                Delete</label>
              <label class="checkbox-label"><input type="checkbox" name="permissions" value="category_export"> Category
                Export</label>
              <label class="checkbox-label"><input type="checkbox" name="permissions" value="auditlogs_view"> Auditlogs
                View</label>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="closeModal('editRoleModal')">Cancel</button>
        <button class="btn btn-primary">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Edit Category Modal -->
  <div class="modal-overlay" id="editCategoryModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Edit Category</h3>
        <button class="modal-close" onclick="closeModal('editCategoryModal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="editCategoryForm">
          <div class="form-group">
            <label>Category Name *</label>
            <input class="form-control" type="text" name="name" placeholder="e.g. Electronics" />
          </div>
          <div class="form-group">
            <label>Status</label>
            <select class="form-control" name="is_active">
              <option value="true">Active</option>
              <option value="false">Inactive</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="closeModal('editCategoryModal')">Cancel</button>
        <button class="btn btn-primary">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Edit Role Privilege Modal -->
  <div class="modal-overlay" id="editRolePrivilegeModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Edit Role Privilege</h3>
        <button class="modal-close" onclick="closeModal('editRolePrivilegeModal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="editRolePrivilegeForm">
          <div class="form-group">
            <label>Role *</label>
            <select class="form-control" name="role_id">
              <option value="">Select a role...</option>
              <option value="admin">Admin</option>
              <option value="user">User</option>
              <option value="editor">Editor</option>
            </select>
          </div>
          <div class="form-group">
            <label>Permission *</label>
            <select class="form-control" name="permission">
              <option value="">Select a permission...</option>
              <option value="user_view">User View</option>
              <option value="user_add">User Add</option>
              <option value="user_update">User Update</option>
              <option value="user_delete">User Delete</option>
              <option value="role_view">Role View</option>
              <option value="role_add">Role Add</option>
              <option value="role_update">Role Update</option>
              <option value="role_delete">Role Delete</option>
              <option value="category_view">Category View</option>
              <option value="category_add">Category Add</option>
              <option value="category_update">Category Update</option>
              <option value="category_delete">Category Delete</option>
              <option value="category_export">Category Export</option>
              <option value="auditlogs_view">Auditlogs View</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="closeModal('editRolePrivilegeModal')">Cancel</button>
        <button class="btn btn-primary">Save Changes</button>
      </div>
    </div>
  </div>

  <script>
    
    /* Navigation */
    const titles = {
      dashboard: 'Dashboard', users: 'Users', roles: 'Roles',
      categories: 'Categories', rolePrivileges: 'Role Privileges',
      auditLogs: 'Audit Logs', myPermissions: 'My Permissions'
    };
    function navigate(section) {
      document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
      document.getElementById('section-' + section).style.display = '';
      document.getElementById('navTitle').textContent = titles[section] || section;
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      event.currentTarget.classList.add('active');
      document.getElementById('sidebar').classList.remove('open');
      document.getElementById('sidebarOverlay').classList.remove('show');
    }


    /* Modal open / close */
    function openModal(id) {
      document.getElementById(id).classList.add('show');
    }
    function closeModal(id) {
      document.getElementById(id).classList.remove('show');
    }
    document.querySelectorAll('.modal-overlay').forEach(overlay => {
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) overlay.classList.remove('show');
      });
    });

  </script>
  <script src="/javascripts/script.js"></script>
</body>

</html>